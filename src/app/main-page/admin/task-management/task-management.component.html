<ion-header>
  Task management
</ion-header>

<ion-content *ngIf="!loadingGroup" class="ion-padding">
  <ion-grid>

    <ion-row>

      <ion-col>

        <ion-item id="selectGroupIon">
          <ion-label>{{currentGroup.name}}</ion-label>
          <ion-select id="selectGroup" value="unselect" okText="Okay" cancelText="Dismiss" (ionChange)="onGroupSelect($event)">
            <ion-select-option *ngFor="let group of (groupStorage._groups | async)" [value]="group" >{{group.name}}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-list id="tasksList">
          <ion-item *ngFor="let task of (taskStorage._tasksGroup | async)" (click)="onClickTask(task)" [ngClass]="{'active': currentTask == task}">
            <ion-label>{{ task.name }}</ion-label>
            <ion-label (click)="onClickDeleteTask(task)">x</ion-label>
          </ion-item>
        </ion-list>
        <ion-button *ngIf="groupSelected" (click)="onClickAdd()">Add Task</ion-button>
        <ion-button id="updateTaskButton" *ngIf="taskSelected" (click)="onClickUpdateTask()">Update Task</ion-button>

      </ion-col>

      <ion-col>
        <div *ngIf="add || updateTask">
          <div *ngIf="add">
            <form id="addTaskForm" (ngSubmit)="addTask()" [formGroup]="formAddTask">
              <ion-item>
                <ion-label for="name">Name</ion-label>
                <ion-input type="name" id="name" name="taskName" formControlName="taskName"></ion-input>
              </ion-item>

              <ion-button id="submitAddTask" type="submit" [disabled]="!formAddTask.valid">Add Task</ion-button>
              <ion-button id="backAddTask" type="button" (click)="onClickCancel()">Back</ion-button>

            </form>
          </div>

          <div *ngIf="updateTask">
            <form id="updateTaskForm" (ngSubmit)="addUpdateTask()" [formGroup]="formUpdateTask">
              <ion-item>
                <ion-label for="name">Name</ion-label>
                <ion-input type="name" id="name2" name="taskName" formControlName="taskName" [value]="currentEditTask.name"></ion-input>
              </ion-item>

              <ion-button id="submitUpdateTask" type="submit" [disabled]="!formUpdateTask.valid">Update Task</ion-button>
              <ion-button id="backUpdateTask" type="button" (click)="onClickCancelUpdateTask()">Back</ion-button>

            </form>
          </div>
        </div>
      </ion-col>

    </ion-row>

  </ion-grid>
</ion-content>

<ion-content *ngIf="loadingGroup" class="ion-padding">
  <app-loading-spiner></app-loading-spiner>
</ion-content>
